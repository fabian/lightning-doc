<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Lightning App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
@page {
    size: a4;
    margin: 30mm 20mm 40mm 25mm;

    @bottom-left {
        content: "Lightning App";
        font-family: "Helvetica Neue", Helvetica, sans-serif;
        font-size: 1em;
        color: #aaa;
        padding-left: 3.75em;
    }

    @bottom-right {
        content: counter(page);
        font-family: "Helvetica Neue", Helvetica, sans-serif;
        font-size: 1em;
        color: #aaa;
    }

    @footnotes {
        margin-bottom: -13mm;
    }
}

html { 
    color: #333;
    font-size: 1em;
    line-height: 1.6;
    font-family: "Helvetica Neue", Helvetica, sans-serif;
    text-rendering: optimizeLegibility; 
}

footer {
    clear: both;
}

a {
  color: #333;
  text-decoration: none;
}

h1,
h2,
h3,
h4,
p,
figure figcaption,
figure.inline,
ul li {
    clear: both;
    font-weight: normal;
    padding-left: 60px;
}

h1 {
    font-size: 3em;
}

h2 {
    font-size: 2em;
}

h3 {
    font-size: 1.5em;
}

h4 {
    font-size: 1.25em;
}

p {
    font-size: 1em;
}

p.code {
    padding-left: 40px;
}

p.code code {
    font-size: 0.8em;
    display: block;
    border-left: 1px solid #126396;
    padding: 0.5em 0 0.5em 19px;
    background-color: #f6f6f6;
}

ul li {
    padding-bottom: 1em;
}

table {
    border-collapse: collapse;
}

table td,
table th {
    padding: 0.2em 0.4em;
    border: 1px solid #ddd;
    font-size: 0.75em;
    text-align: left;
}

figure {
    padding: 1.5em 0;
    margin: 0;
}

figure img {
    max-width: 100%;
}

figure table {
    margin-bottom: 1em;
}

figure figcaption {
    font-size: 0.75em;
}

figure.inline figcaption {
    padding-left: 0;
}

a[href^="http"]:after {
    content: attr(href);
    float: footnote;
    margin-left: 60px;
    counter-increment: footnote;
    font-size: 0.75em;
    footnote-style-position: inside;
}

a[href^="http"]:after::footnote-call {
    content: " [" counter(footnote) "]";
    font-size: 1.3em;
}

a[href^="http"]:after::footnote-marker {
    content: "[" counter(footnote) "] ";
}

div.chapter {
    counter-increment: chapter;
    counter-reset: footnote;
    margin-top: 3em;
}

div.chapter h2 {
    padding-left: 0;
}

div.chapter h2:before {
    content: counter(chapter);
    width: 1.5em;
    padding-right: 0.375em;
    display: inline-block;
    text-align: right;
}

div.chapter h3 {
    counter-increment: sub-chapter;
    padding-left: 0;
}

div.chapter h3:before {
    content: counter(chapter) "." counter(sub-chapter);
    width: 2em;
    padding-right: 0.5em;
    display: inline-block;
    text-align: right;
}

h3.break,
div.chapter {
    page-break-before: always;
}

#front {
    page-break-after: always;
}

#front h1 {
    margin: 1em 0 0.5em 0;
}

#front .logo {
    display: none;
}

#front .screenshot {
    padding-top: 4em;
    padding-bottom: 0em;
    margin-left: -0.5em;
}

#front,
#second {
    margin-bottom: 3em;
}

#toc,
#toc ol,
#figures {
    list-style-type: none;
    padding: 0;
    margin: 0;
}

#toc > li {
    padding-bottom: 1em;
}

#toc a:after,
#figures a:after {
    content: " " leader(".") " " target-counter(attr(href), page);
}

#toc .chapter {
    display: inline-block;
    padding-left: 1em;
    padding-right: 0.75em;
    text-align: left;
    width: 2em;
}

#figure-aufwand table td:not(:first-child) {
    text-align: center;
}
    
#figure-aufwand table tr.total td {
    font-weight: bold;
}

@media screen {

    html {
        font-size: 0.8em;
    }

    body {
        margin: 3em 0 4em 0;
    }

    p {
        padding-right: 3em;
    }

    a {
        color: #1b60a7;
    }

    a[href^="http"]:after {
        display: none;
    }

    #front h1 {
        margin: 1em 0 0 0;
    }

    #front .logo {
        display: block;
        padding-bottom: 2em;
    }

    #front .screenshot {
        display: none;
    }

    #second,
    div.chapter {
        border-top: 1px solid #ddd;
    }
}

@media screen and (min-width: 40.5em) {

    html {
        font-size: 1em;
    }

    body {
        margin: 4em 3em 6em 3em;
    }

    #second,
    div.chapter {
        max-width: 40em;
    }

    #front {
        position: relative;
        top: -4em;
        left: -3em;
        width: 100%;
        padding: 4em 3em 2em 3em;
        margin-bottom: -4em;
    }

    #front h1 {
        margin: 1em 0 5.5em 0;
    }

    #front .logo {
        display: block;
        position: fixed;
        margin: 0;
        padding: 0;
        top: 4em;
        right: 4.5em;
        width: 50px;
        height: 50px;
        opacity: 0.1;
        -webkit-transition: opacity 0.5s linear;
        -moz-transition: opacity 0.5s linear;
    }

    #front:hover .logo {
        opacity: 1;
    }
}

</style>
<script>

function item(node, id, chapter, subChapter) {

    var li, a, spanChapter, spanTitle;

    node.setAttribute('id', id);

    li = document.createElement('li');

    a = document.createElement('a');
    a.setAttribute('href', '#' + id);

    chapter = '' + chapter;
    if (typeof subChapter != 'undefined') {
        chapter += '.' + subChapter;
    }

    spanChapter = document.createElement('span');
    spanChapter.setAttribute('class', 'chapter');
    spanChapter.appendChild(document.createTextNode(chapter));
    a.appendChild(spanChapter);

    spanTitle = document.createElement('span');
    spanTitle.setAttribute('class', 'title');
    spanTitle.appendChild(document.createTextNode(node.innerHTML));
    a.appendChild(spanTitle);

    li.appendChild(a);

    return li;
}

function toc() {

    var headers = document.getElementsByTagName('h2'),
        toc = document.getElementById('toc'),
        i, j, node, id, chapter, li, childs, ol;

    // skip first header (TOC)
    for (i = 1; i < headers.length; i++) {

        node = headers[i];
        id = 'chapter-' + i;
        li = item(node, id, i);

        childs = node.parentNode.getElementsByTagName("h3");
        ol = document.createElement('ol');

        for (j = 0; j < childs.length; j++) {

            node = childs[j];
            id = 'chapter-' + i + '-' + (j + 1);
            sli = item(node, id, i, j + 1);
            ol.appendChild(sli); 
        }

        li.appendChild(ol);
        toc.appendChild(li);
    }
}

function figures() {

    var captions = document.getElementsByTagName('figcaption'),
        figures = document.getElementById('figures'),
        i, caption, figure, li, a;

    for (i = 0; i < captions.length; i++) {

        caption = captions[i];
        figure = caption.parentNode;

        caption.innerHTML = 'Abb. ' + (i + 1) + ' ' + caption.innerHTML;

        li = document.createElement('li');

        a = document.createElement('a');
        a.setAttribute('href', '#' + figure.getAttribute('id'));

        a.appendChild(document.createTextNode(caption.textContent));

        li.appendChild(a);
        figures.appendChild(li); 
    }
}

function init() {

    figures();
    toc();
}

</script>
</head>
<body onload="init();">

<div id="front">
<p>
ZHAW Zürcher Hochschule für Angewandte Wissenschaften<br/>
Bachelorstudium Informatik<br/>
Seminararbeit Entwickeln von Anwendungen für Hand-Held<br/>
Dozent: Christian Vils<br/>
Herbstsemester 2012
</p>
<h1>Lightning App</h1>
<p class="logo">
<img src="images/lightning.svg" width="50" height="50" />
</p>
<p class="screenshot">
<img src="images/screenshot.png" width="207" height="410" />
</p>
<p>
Cyril Gabathuler, <a href="mailto:cyril@lightningapp.ch">cyril@lightningapp.ch</a><br/>
Fabian Vogler, <a href="mailto:fabian@lightningapp.ch">fabian@lightningapp.ch</a><br/>
9. Januar 2013
</p>
</div>

<div id="second">
<h2>Inhaltsverzeichnis</h2>
<ol id="toc"></ol>
</div>

<div class="chapter">
<h2>Einleitung</h2>

<h3>Ausgangslage</h3>
<p>
Ausgelöst durch den aktuellen Trend hin zur mobilen Nutzung sind diverse neue 
Applikationen zur Erfassung und Verwaltung von Merklisten erschienen. Nur wenige
erlauben es aber, die Listen mit anderen Personen gemeinsam zu nutzen. Oft muss 
dazu auch zuerst ein Benutzerkonto mit Benutzernamen und Passwort erstellt 
werden. Dieses vom Desktop-Computer übernommene Konzept funktioniert im mobilen 
Kontext aufgrund der eingeschränkten Eingabemöglichkeiten und den 
unterschiedlichen Endgeräten jedoch suboptimal.
</p>

<h3>Ziele der Arbeit</h3>
<p>
Entwicklung einer iPhone-App, welche es ermöglicht Listen unter mehreren 
Personen zu teilen, sowie einer dazugehörender API mit einem Web-Frontend. 
Informationen über Änderungen einer Liste sollen dem Benutzer zudem zeitnah über 
Benachrichtigungen angezeigt werden. Der Benutzer soll ohne Benutzername 
und Passwort auf einem beliebigen Gerät im Browser auf seine Listen zugreifen 
können. Dazu soll ein eigenes Authentifizierungsverfahren verwendet werden.
</p>

<h3>Aufgabenstellung</h3>
<p>
Konzeption und Implementation einer iPhone-App sowie einer Web-Applikation zur 
gemeinsamen Nutzung von Listen. Ausarbeitung eines eigenen 
Authentifizierungsverfahren zwischen der iPhone-App und der Web-Applikation für 
den geräteunabhängigen Zugriff auf die Listen.
</p>

<h3>Teaser</h3>
<p>
Der Teaser gibt einen Überblick über das Projekt und ist online zugänglich unter
<a href="http://teaser.lightningapp.ch/">teaser.lightningapp.ch</a>. Um den
Teaser auch noch etwas speziell zu machen, wurde eine Animation eingebaut.
</p>

<p>
Die HTML-Seite des Teasers setzt sich aus einer kurzen Beschreibung des Projekts
und einer Animation der App zusammen. Die Animation der App ist ein GIF, welches
über die Abbildung eines iPhones gelegt ist, und zeigt den Start der App in 8
Einzelbildern.
</p>

<figure id="figure-teaser">
<img src="images/teaser.png" />
<figcaption>Teaser im Web</figcaption>
</figure>
</div>

<div class="chapter">
<h2>Projektmanagement</h2>

<h3>Projektteam</h3>
<p>
Das Projektteam setzt sich aus Fabian Vogler und Cyril Gabathuler zusammen. 
Fabian Vogler ist für die API und das Web Interface verantwortlich und Cyril 
Gabathuler hat die Verantwortung für die iPhone App übernommen.
</p>

<h3>Projektplanung</h3>

<p>
Der folgende Projektplan gibt einen Überblick über den Ablauf des Projekts
und dessen wichtigsten Meilensteine.
</p>

<figure id="figure-gantt">
<table>
    <colgroup>
        <col width="160" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
        <col width="25" />
    </colgroup>
    <thead>
        <tr>
            <th>&#160;</th>
            <th colspan="4">September</th>
            <th colspan="4">Oktober</th>
            <th colspan="4">November</th>
            <th colspan="4">Dezember</th>
            <th colspan="4">Januar</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Kick-Off</td>
            <td colspan="1">&#160;</td>
            <td colspan="4" style="border-left: 0;">◆ 12.09.12</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
        </tr>
        <tr>
            <td>Teaser</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td colspan="2" style="background-color: #e8f0f8;">&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
        </tr>
        <tr>
            <td>Abgabe Teaser</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td colspan="4" style="border-left: 0;">◆ 28.11.12</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
        </tr>
        <tr>
            <td>Umsetzung</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td colspan="11" style="background-color: #e8f0f8;">&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
        </tr>
        <tr>
            <td>Dokumentation</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td colspan="7" style="background-color: #e8f0f8;">&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
        </tr>
        <tr>
            <td>Arbeitstreffen</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td colspan="4" style="border-left: 0;">◆ 05.12.12</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
        </tr>
        <tr>
            <td>Präsentation</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td colspan="2" style="background-color: #e8f0f8;">&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
        </tr>
        <tr>
            <td>Schlusspräsentation</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td>&#160;</td>
            <td colspan="4" style="border-left: 0;">◆ 09.01.13</td>
        </tr>
    </tbody>
</table>
<figcaption>Projektplanung</figcaption>
</figure>

<h3 class="break">Aufwand</h3>

<p>
Laut Reglement sollte der Aufwand pro Student 75h betragen. Entsprechend wurde 
die Planung darauf ausgelegt. Grosse Hindernisse waren unter anderem externe 
Services, wie die Push Notification Infrastruktur von Apple.
</p>

<figure id="figure-aufwand" class="inline">
    <table>
        <colgroup>
            <col width="200" />
            <col width="50" />
            <col width="50" />
            <col width="50" />
            <col width="50" />
        </colgroup>
        <thead>
            <tr>
                <th>Beschreibung</th>
                <th colspan="2">API / Web</th>
                <th colspan="2">iOS</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>&#160;</td>
                <td>Soll</td>
                <td>Ist</td>
                <td>Soll</td>
                <td>Ist</td>
            </tr>
            <tr>
                <td>Projekt aufsetzen</td>
                <td>2h</td>
                <td>4h</td>
                <td>2h</td>
                <td>3h</td>
            </tr>
            <tr>
                <td>Listen erfassen</td>
                <td>10h</td>
                <td>4h</td>
                <td>10h</td>
                <td>8h</td>
            </tr>
            <tr>
                <td>Items erfassen</td>
                <td>8h</td>
                <td>5h</td>
                <td>6h</td>
                <td>8h</td>
            </tr>
            <tr>
                <td>Items editieren</td>
                <td>5h</td>
                <td>6h</td>
                <td>10h</td>
                <td>12h</td>
            </tr>
            <tr>
                <td>Listen teilen</td>
                <td>8h</td>
                <td>12h</td>
                <td>7h</td>
                <td>10h</td>
            </tr>
            <tr>
                <td>Web Interface</td>
                <td>10h</td>
                <td>9h</td>
                <td>0h</td>
                <td>0h</td>
            </tr>
            <tr>
                <td>Authentifizierung</td>
                <td>10h</td>
                <td>14h</td>
                <td>5h</td>
                <td>3h</td>
            </tr>
            <tr>
                <td>Push Notifications</td>
                <td>5h</td>
                <td>4h</td>
                <td>10h</td>
                <td>15h</td>
            </tr>
            <tr>
                <td>Continuous Integration</td>
                <td>5h</td>
                <td>13h</td>
                <td>3h</td>
                <td>5h</td>
            </tr>
            <tr>
                <td>Dokumentation</td>
                <td>12h</td>
                <td>12h</td>
                <td>12h</td>
                <td>12h</td>
            </tr>
            <tr class="total">
                <td>Total</td>
                <td>75h</td>
                <td>83h</td>
                <td>75h</td>
                <td>76h</td>
            </tr>
        </tbody>
    </table>
    <figcaption>Soll / Ist Vergleich Aufwand</figcaption>
</figure>

<h3>Dokumentation</h3>

<p>
Die Dokumentation wurde rein in HTML und CSS geschrieben. Das Inhalts- und das
Abbildungsverzeichnis wurden dynamisch mit JavaScript generiert. Um die Seite
auch korrekt ausdrucken zu können, wurde die Software
<a href="http://www.princexml.com/">Prince</a> verwendet, welche HTML-Seiten
in PDFs umwandelt. Dadurch konnte diese Dokumentation gleich wie der Source-Code
der Applikation selbst mit der Versionverwaltungssoftware Git verwaltet und über
den Online-Service <a href="https://github.com/">GitHub</a> geteilt werden.
</p>

</div>

<div class="chapter">
<h2>Authentifizierung</h2>
<p>
Um von jedem beliebigen Gerät auf die eigenen Listen zugreifen zu können, ist
ein Prozess notwendig, um die Verbindung mit dem Account herzustellen und den 
Zugriff auf diesen zu berechtigen.
</p>

<figure id="figure-authentication">
<img src="images/authentication.png" />
<figcaption>Ablauf Authentifizierung</figcaption>
</figure>

<p>
Step 1: Jeder Account ist über eine einzigartigen Link erreichbar. Dieser Link 
kann in der App angezeigt und per E-Mail versendet werden. Da dieser Link
immer gleich bleibt, kann er auch problemlos als Lesezeichen gespeichert werden.
</p>

<p>
Step 2: Beim Aufruf des Links auf einem Desktop-Browser erscheint die Login-Seite,
von welcher mit dem Klick auf einen Knopf der Authentifizierung-Prozess gestartet
werden kann.
</p>

<p>
Step 3: Nachdem im Browser die Authentifizierung-Anfrage abgeschickt wurde,
erhält das mobile Geräte eine Push-Nachricht. Die App bietet die Möglichkeit,
die Anfrage zu ignorieren oder diese anzusehen.
</p>

<p>
Step 4: Innerhalb der App muss dann der im Browser angezeigte Sicherheitscode
eingegeben und bestätigt werden.
</p>

<p>
Step 5: Nachdem die Bestätigung des Sicherheitscodes in der App erfolgt ist, erscheinen
im Browser automatisch die Listen des Accounts. Der Benutzer kann dann diese an
</p>

<h3>Sicherheitscode</h3>

<p>
Um einen ausreichenden Schutz bieten zu können und trotzdem bedienungsfreundlich
zu sein, ist ein Sicherheitscode für die Authentifizierung nötig, welcher
gewissen Anforderungen entspricht.
</p>

<p>
Die anfängliche Idee eines Tic-Tac-Toes wurde verworfen, da es zu wenig mögliche
Kombinationen gibt und zu einfach zu knacken wäre. Durch die 2 möglichen Werte
der 9 Felder ergäben sich nur 2^9 = 512 Kombinationen. Eine Erhöhung der Anzahl
der Felder auf 16 würde zwar deutlich mehr Kombinationen ergeben (2^16 = 65 536),
jedoch leidet dann die Bedienung, da das Muster deutlich komplexer wird.
</p>

<figure id="figure-tictactoe" class="inline">
<img src="images/tic-tac-toe.png" width="300" height="270" />
<figcaption>Authentifizierung mit Tic-Tac-Toe</figcaption>
</figure>

<p>
Eine sichere und trotzdem einfache Alternative, die auch oft bei der
Authentifizierung im E-Banking verwendet wird, ist eine vierstellige
Zahlenkombination. Diese kann leicht eingegeben werden, da den meisten Benutzern
Zahlenkombinationen bekannt sind, und bieten eine genügende Sicherheit mit 10^4 
= 10 000 Kombinationen.
</p>

<p>
    Auf dem iPhone wird folgende View dargestellt sobald der User den Link aufruft.
    Der User wird aufgefordert die vierstellige Zahlenkombination einzugeben.
</p>
<figure id="figure-challenge" class="inline">
    <img src="images/challenge.png" height="500" />
    <figcaption>Challenge View auf dem iPhone</figcaption>
</figure>

<h3>Zwei-Faktor-Authentifizierung</h3>
<p>
Eine Zwei-Faktor-Authentifizierung setzt sich typischerweise aus Elementen die 
der User kennt und die ein User besitzt zusammen.
</p>

<p>
Etwas was ein User kennt: Der User ist im Besitz einer eindeutigen URL, welcher
nur er kennen sollte.
</p>

<p>
Etwas was ein User besitzt: Der User ist im Besitz der Lightning App auf seinem
iPhone, welche eine Challenge erhalten wird.
</p>

<p>
Der Zugriff auf das Web Interface ist also durch eine
Zwei-Faktor-Authentifizierung geschützt. Es besteht aber keine «Strong»-
Authentifizierung, weil die URL in der App dargestellt wird. Würde ein User sein
iPhone verlieren hätte ein Fremder ebenfalls Zugriff auf das Web Interface.
</p>

</div>

<div class="chapter">
<h2>Web-Applikation</h2>

<h3>Architektur</h3>

<p>
Die Applikation befolgt die grundsätzlichen Prinzipien zweier moderner
Software-Architekturen. Zum einen die Model–View–Controller-Architektur als Basis
für den Aufbau der Software, zum anderen die REST-Architektur, welche die
Struktur der API vorgibt.
</p>

<h4>Model-View-Controller</h4>

<p>
Für die Software kommt eine an das Web angepasster Form der
Model–View–Controller-Architektur zur Anwendung, welche mithilfe des
PHP-Frameworks <a href="http://symfony.com/">Symfony</a> in der Version 2.1
umgesetzt wurde:
</p>

<figure id="figure-package-diagram">
<img src="images/package-diagram.png" />
<figcaption>Paketdiagramm der Web-Applikation</figcaption>
</figure>

<p>
Das Model setzt sich aus den gespeicherten Daten und der
Business-Logik zusammen. Es besteht aus den Klassen in den Paketen
<code>Lightning\ApiBundle\Entity</code> und
<code>Lightning\ApiBundle\Service</code>.
</p>
<p>
Die View ist für die Darstellung der Daten zuständig. Sie
entscheidet basierend auf der Anfrage des Benutzers, in welcher Form die Daten
dargestellt werden. Diese Funktion wird in der API hauptsächlich durch das
Symfony Bundle namens 
<a href="https://github.com/FriendsOfSymfony/FOSRestBundle">FOSRestBundle</a>
erledigt, welches die Daten des Controllers gemäss dem HTTP-Header
<code>Accept</code> entweder in JSON oder XML zurückgibt.
</p>
<p>
Der Controller nimmt Benutzeranfragen entgegen und ruft die
nötigen Befehle aus dem Model auf. Er gibt dann die Daten aus dem Model an die
View weiter, damit diese die Daten darstellen kann. Die dafür zuständigen Klassen
befinden sich im Paket <code>Lightning\ApiBundle\Controller</code>.
</p>
<p>
Gespeichert werden die Daten in einer MySQL-Datenbank, der Zugriff erfolgt über
die Hilfsklassen von Symfony.
</p>

<h3 class="break">Entwicklung</h3>

<p>
Um ein einfaches Deployment zu ermöglichen und ein Auslieferung von fehlerhaftem
Source-Code zu verhindern, wurde eine ganze Kette von automatischen Prozessen und
Tools eingerichtet, die bei der Entwicklung immer wieder durchlaufen werden:
</p>

<figure id="figure-deploy">
<img src="images/deploy.svg" width="500" height="230" />
<figcaption>Übersicht Ablauf Entwicklung</figcaption>
</figure>

<h4>
Lokale Entwicklung
</h4>
<p>
Entwickelt wird die Applikation lokal auf dem Computer des Entwicklers.
Die Installationstionsvoraussetzungen sind minimal und werden mit den meisten
modernen, unixähnlichen Betriebssystemen (wie z.B. Mac OS X) mitgeliefert.
Konkret wird nur der MySQL Community Server und PHP ab Version 5.3 vorausgesetzt 
- auf Windows kann dieses auch
einfach manuell installiert werden. Sämtliche restlichen Abhängigkeiten können
mit dem PHP Dependency Manager namens Composer installiert werden.
</p>
<p>Die Verwaltung
des Source Codes erfolgt über die Versionverwaltungs-Software Git und damit der
Source Code auch allen zugänglich ist, wird zudem der kostenlose Dienst GitHub
eingesetzt.
</p>
<p>
Um das Projekt auf einem Computer komplett zu installieren, genügen folgende
Befehle:
</p>
<p class="code">
<code>
git clone git://github.com/fabian/lightning-web.git lightning-web<br/>
curl -s http://getcomposer.org/installer | php<br/>
php composer.phar install --dev<br/>
php app/console doctrine:database:create<br/>
php app/console doctrine:migrations:migrate<br/>
php app/console server:run
</code>
</p>
<p>
Mit diesen Befehlen wird der Source Code heruntergeladen, die Abhängigkeiten
installiert, die benötigten Datenbanken erstellt und der Entwicklungsserver
gestartet. Danach ist die Applikation unter http://localhost:8000/ benutzbar.
</p>

<h4>
GitHub
</h4>
<p>
Der zentrale Server der Versionsverwaltung ermöglicht Reviews von Änderungen
und löst per Webhook die Ausführung der Unit-Tests auf Travis-CI sowie die
Überprüfung der Coding-Guidelines aus. Der Source-Code der Web-Applikation findet
sich als Open-Source-Projekt öffentlich ersichtlich unter
<a href="https://github.com/fabian/lightning-web">github.com/fabian/lightning-web</a>.
</p>

<h4>
Automated Code Reviews
</h4>
<p>
Der kostenlose Dienst
<a href="http://jmsyst.com/automated-code-reviews/">Automated Code Reviews for
PHP</a> überprüft für Open-Source-Projekte, welche auf GitHub
gehostet sind, die Einhaltung von Konventionen und sucht automatisch nach
typischen Programmierfehlern im Code, indem es den Code statisch analysiert.
Werden Fehler gefunden, erhält der Entwickler ein E-Mail mit den gefundenen
Fehlern. Zudem erstellt der Dienst selbständig Pull Requests mit
Korrekturvorschlägen.
</p>

<h4>
Travis CI
</h4>
<p>
Ebenfalls kostenlos für Open-Source-Projekte ist der
Continious-Integration-Service <a href="https://travis-ci.org/">Travis CI</a>.
Bei jedem Commit wird
auf dem Travis-Server eine virtuelle Maschine gestartet und das Projekt
installiert. Dann werden die Unit Tests mit
<a href="https://github.com/sebastianbergmann/phpunit/">PHPUnit</a> ausgeführt 
und die Coding-Guidelines mit
<a href="https://github.com/squizlabs/PHP_CodeSniffer">PHPCS</a> überprüft.
Nur wenn beide Prüfungen erfolgreich waren, wird
der Zustand der Web-Applikation als stabil erachtet und das Deployment
angestossen. Ansonsten erhält der Entwickler wiederum ein E-Mail mit einem
Hinweis auf den Fehler.
</p>

<p>
Die Code Coverage von Unit Tests ist immer mit Vorsicht zu geniessen ist, da keine
Aussage über die Wichtigkeit der getesteten Teile gemacht werden kann. Dennoch
konnte in den meisten Paketen eine Abdeckung von über 90% erreicht werden.
</p>

<figure id="figure-coverage">
<img src="images/coverage.png" />
<figcaption>Code Coverage der Unit Tests</figcaption>
</figure>


<h4>
Padoga Box
</h4>
<p>
<a href="https://pagodabox.com/">Padoga Box</a> bietet einen skalierbaren
Webserver für PHP-Applikationen (Cloud-Hosting). Eine einzelne Server-Instanz
kann kostenlos betrieben werden, steigt die Benutzeranzahl, kann einfach gegen
eine Gebühr die Anzahl der Server erhöht werden.
</p>
<p>
Das Deployment bei Pagoda Box erfolgt ebenfalls mit Git. Es gäbe die Möglichkeit,
einen Private Key mit Deployment-Rechten auf dem Travis-Server zu hinterlegen,
wodurch nach den erfolgreichen Tests direkt von dort deployed werden könnte. Dies
hätte aber zum Nachteil, dass der Private Key öffentlich wäre und jede Person
beliebigen Code auf den Server deployen könnte. Es wurde deshalb eine separate
Deployment-Applikation mit PHP geschrieben und auf einem separaten Server
installiert. Die Deployment-Applikation wird von Travis aufgerufen und überprüft
dessen Signatur anhand eines geheimen Tokens und führt dann das Deployment durch.
</p>

</div>

<div class="chapter">
<h2>iPhone App</h2>

<h3>Architektur</h3>
<p>
Die iPhone App wurde nativ mit Objective-C umgesetzt. iOS 6 wird vorausgesetzt was den Vorteil
von neuen und aktuellen API's mit sich bringt.
</p>
<h4>Model-View-Controller</h4>
<p>
Die App wurde nach dem Model-View-Controller Pattern umgesetzt. Dabei wurden die meisten GUI's
manuell und programmatisch erstellt, teilweise jedoch auch mit Hilfe des Interface Builders.
</p>
<h4>Persistenz</h4>
<figure id="figure-erm" class="inline">
    <img src="images/erm.png" height="200"/>
    <figcaption>ERM</figcaption>
</figure>
<p>
</p>
<p>
    Für die Persistenz der Daten wurde CoreData eingesetzt. CoreData ist eine Objektrelationale Datenbank,
    welche ein SQL Lite File zur Speicherung der Daten benutzt. Verschiedene API's stehen zur Verfügung um
    die Daten zu mutieren.
</p>
<h4>Dependecy Management</h4>
<p>
    <a href="http://cocoapods.org">CocoaPods</a> wurde eingesetzt um ein Dependecy Management für die App Entwicklung einzusetzen.
    In einem File names <code>PodFile</code> werden die verschiedenen Abhängigkeiten (pod) definiert. Es kann
    auch die Version von iOS definiert werden.
</p>
<p class="code">
<code>
    platform :ios, '6.0'<br />
    <br />
    pod 'AFNetworking', '~> 1.1.0'
</code>
<p>
    Nach dem das PodFile definiert ist können mit Hilfe des Befehls
</p>
<p class="code">
<code>
    pod install
</code>
</p>
<p> die verschiedenen Abhängigkeiten installiert bzw. mit</p>
<p class="code">
<code>
    pod update
</code>
<p>ein Update der Abhängigkeiten angestossen werden.</p>
<h4>AFNetworking</h4>
<p>
    Zur Kommunikation mit dem Server wurde das <a href="http://afnetworking.com">AFNetworking</a> Framework in der Version 1.1.0 eingesetzt.
    AFNetworking hat sich in der Community beliebt gemacht, weil es sehr klein und nahe an der API
    von Apple ist. Das Framework wurde stark auf REST Webservices ausgelegt und bietet die
    entsprechenden Funktionalitäten von Haus aus an.
</p>
<h4>In-App Kauf</h4>
<p>
    Gewisse Funktionalität in der App wird nur durch den Kauf eines Jahres-Abo von CHF 1.00 freigeschaltet. 
    Dies umfasst das Teilen von Listen, die Speicherung der Daten in der «Cloud» und die Benutzung des
    Web Interfaces.
</p>
<p>
    Apple bietet die Möglichkeit an, innerhalb von einer App einen sogenannten In-App Kauf zu tätigen.
    Es gibt drei verschiedene Typen von Produkten:
</p>
<p>
    <strong>Konsumierbare</strong> Produkte, welche der User jedes Mal kaufen muss falls er dieses
    Produkt braucht.
</p>
<p><strong>Nicht konsumierbare</strong> Produkte, kauft der User ein einziges Mal.
    Entsprechend werden durch StoreKit(API von Apple) Möglichkeiten zur Wiederherstellung angeboten.
</p>
<p><strong>Automatische verlängernde Abos</strong> werden nur für die App Newstand und darin
    enthaltene Magazine angeboten.
</p>
<p>
    Wie bereits erwähnt lassen sich automatisch verlängernde Abos nur für gewissen Typen von App's einsetzen.
    Daher wurde mit Hilfe von konsumierbaren Produkten versucht ein Abo zu imitieren. Ab Kaufdatum kann der
    User 1 Jahr mit dem Server kommunizieren. Entsprechend wird er vor Ablauf des Jahres zur Verlängerung des
    Abo's aufgefordert.
</p>
<p>Prinzipiell ist der Ablauf eines Kaufes wie folgt: Die App fragt bei einem Apple Server anhand einer speziellen
    ID nach den Produktinformationen. Diese werden aufbereitet dem User dargestellt, siehe
    <a href="#figure-in-app-button">In-App Button für den Kauf</a>. Entscheidend
    sich der User ein Abo zu kaufen wird dies dem Apple Server mitgeteilt und der Account des Users wird belastet.
    Der App wird einen sogenannten «Kassenzettel» zur Validierung des Kaufes zu Verfügung gestellt.
    Dieser Kassenzettel wird an die Server von lightningapp.ch übermittelt, welche wiederum mit einem Apple Server kommuniziert.
    Durch diesen Ansatz kann eine Man-in-the-middle Attacke abgewehrt werden.</p>
<figure id="figure-in-app-purchase" class="inline">
    <img src="images/in_app_purchase.png" width="300" />
    <figcaption>Ablauf eines In-App Kaufes (Bild von <a href="https://developer.apple.com/library/ios/#documentation/NetworkingInternet/Conceptual/StoreKitGuide/APIOverview/OverviewoftheStoreKitAPI.html#//apple_ref/doc/uid/TP40008267-CH100-SW1">Apple</a>)</figcaption>
</figure>
<figure id="figure-in-app-button" class="inline">
    <img src="images/in_app_button.png" width="200" />
    <figcaption>In-App Button für den Kauf</figcaption>
</figure>

<h4>Push Notifications</h4>
<p>Die App wurde darauf ausgelegt Push Notifications zu erhalten. Diese werden verschickt, sobald eine
	Änderung an einer geteilten Liste erkannt worden ist. Folgendermassen würde beispielhaft eine
	Nachricht aussehen.</p>
<figure id="figure-push-notification" class="inline">
    <img src="images/push.png" width="300" />
    <figcaption>Push Notification</figcaption>
</figure>

<h3>Entwicklung</h3>

<figure id="figure-workflow" class="inline">
    <img src="images/workflow.png" width="300" />
    <figcaption>Workflow iPhone App</figcaption>
</figure>

<h4>GitHub</h4>
<p>
    Der Source-Code wird auf GitHub in einem privaten Repository gehalten. Zugang haben nur die Entwickler. Über einen Webhook wird der Build Prozess
    für den Jenkins angestossen (Schritt 1).
</p>

<h4>Jenkins CI</h4>
<p>
    <a href="http://jenkins-ci.org">Jenkins</a> wird verwendet um die App kontinuierlich zu builden. Es wurde ein Job definiert, welcher der Build
    Prozess anstösst sobald ein Änderung auf GitHub gepusht worden ist. Das Ergebnis eines Builds ist ein sogenanntes 
    IPA File (Schritt 2). Dieses enthält die App an sich. Dieses File wird direkt auf TestFlight hochgeladen (Schritt 3).
</p>

<h4>
TestFlight
</h4>
<p>
<a href="http://testflightapp.com">TestFlight</a> bietet die Möglichkeit die App einfach an verschiedene Tester zu verteilen und Feedback einzusammeln (Schritt 4).
Tester müssen sich über ein Link registrieren und erhalten danach die Möglichkeit die App zu installieren. In der App
haben die Tester die Möglichkeit Feedback an die Entwickler zu senden.
</p>
<figure id="figure-testflight-feedback" class="inline">
    <img src="images/testflight-feedback.png" height="500"/>
    <figcaption>Feedback Button für die Entwickler</figcaption>
</figure>

<h4>
Crashlytics
</h4>
<p>
Um Abstürze während der Testphase zu dokumentieren wurde das Framework <a href="https://www.crashlytics.com">Crashlytics</a> eingesetzt. Sollte die App
abstürzen wird ein Logfile erstellt, welches in einem Web Interface von Crashlytics dargestellt wird.
Dies vereinfacht die Suche nach Fehler in der Applikation und der Einfluss auf die User kann gemessen werden.
</p>

</div>


<div class="chapter">
<h2>Schlusswort</h2>

<figure id="figure-teaser" class="inline">
<img src="images/titel.png" width="400" />
<figcaption>App in Benutzung</figcaption>
</figure>

<p>
Das Projekt hat gezeigt, dass bei der modernen Applikationsentwicklung unzählige
Komponenten mitspielen: Konzepte wie REST oder Zwei-Faktor-Authentifizierung
müssen verstanden werden, Tools wie Continious-Integration-Server müssen
aufgesetzt und gewartet werden - und neue Technologien müssen erlernt und optimal
eingesetzt werden können. Der Trend zur mobilen Nutzung hat die Programmierung
nicht einfacher gemacht, sondern um weitere Komponenten erweitert.
</p>

<p>
	Das Zusammenspiel mit externen Anbietern war teilweise sehr nervenaufreibend und zeitaufwendig.
	Entsprechend froh ist man wenn alle Puzzleteile letztendlich zusammenpassen und man
	eine lauffähige App vor sich in den Händen hält. 
</p>

<p>
	Die Herausforderung eine App zu entwickeln, welche mit einem Server im Internet
	kommuniziert konnte gemeistert werden. Neue Technologien und Services konnten integriert werden,
	um eine «State of the Art»-App zu entwickeln.
</p>

</div>

<div class="chapter">
<h2>Anhang</h2>

<h3>Glossar</h3>

<p>
API: Application Programming Interface, bezeichnet die Schnittstelle, über
welche der Client Daten vom Server abruft.
</p>
<p>
Client: Ein Anwendungsprogramm, welches auf dem Gerät des Benutzers läuft und
meist mit einem Server kommuniziert.
</p>
<p>
REST: Representational State Transfer, ist eine Architektur für eine API, welche
die nach HTTP definierten Regeln befolgt.
</p>
<p>
Bundle: Zusammenfassung mehrerer Klassen und Konfigurationsdateien innerhalb
eines Symfony-PHP-Projekts.
</p>
<p>
HTTP: Hypertext Transfer Protocol, ist ein Protokoll zur Übertragung von Daten
über ein Netzwerk.
</p>
<p>
HTTP-Header: Feld einer HTTP-Übertragung, welches zusammen mit den Daten im HTTP-
Protokoll übertragen wird.
</p>
<p>
JSON: JavaScript Object Notation, ist ein kompaktes, lesbares Datenformat,
welches oft im Internet verwendet wird.
</p>
<p>
XML: Extensible Markup Language, ist ebenfalls ein Datenformat, welches oft
im Internet Verwendung findet, jedoch mächtiger ist als JSON.
</p>
<p>
Desktop: Computer, welche von einem Benutzer bedient meist an einem Schreibtisch
bedient wird.
</p>
<p>
Browser: Software zur Darstellung von Websiten aus dem Internet. Beispielsweise
Google Chrome oder Mozilla Firefox.
</p>
<p>
Webhook: Eine Internet-Adresse, welche bei einem bestimmten Ereignis aufgerufen
wird, damit weitere Aktionen ausgeführt werden können.
</p>
<p>
URL: Uniform Resource Locator, eine Internet-Adresse welche auf eine Ressource
wie z.B. eine Website zeigt.
</p>
<p>
Pull Request: Aufforderung bei GitHub, Änderungen am Source-Code eines Projekts
in das Programm aufzunehmen.
</p>
<p>
Continious Integration: Automatisches und regelmässiges ausführen von Tests
und/oder Deployments.
</p>
<p>
Private Key: Geheimer Schlüssel, welcher für eine asymmetrische Verschlüsselung
verwendet wird.
</p>
<p>
Deployment: Installation und Konfiguration einer Anwendung auf einem Server oder
einem Endgerät.
</p>
<p>
Man-in-the-middle: Angriff auf die Kommunikation zwischen zwei Punkten, bei
welcher Daten abgehört und/oder modifiziert werden.
</p>
<p>
Code Coverage: Beschreibt, wie viel Prozent des Source-Codes durch Unit Tests
abgedeckt werden.
</p>
<p>
Interface Builder: Ein Tool, welches das Erstellen von GUI's mit Hilfe eines
Baukastensystems vereinfacht.
</p>

<h3 class="break">Abbildungsverzeichnis</h3>

<ul id="figures"></ul>

</div>

<footer>&#160;</footer>

</body>
</html>
